<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SIP - Proyecto Individual</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="/Public/Favoritos.css">
</head>
<body>
  <div class="main-container">
    <!-- Header -->
    <header class="header">
      <img src="../html/css/img/logo copy.png" alt="SIP Logo" class="logo-header">
      <nav class="nav-header">
        <a href="#"><i class="fa-solid fa-layer-group"></i> Proyectos</a>
        <a href="#" id="notificaciones-btn"><i class="fa-regular fa-bell"></i> Notificaciones</a>
        <div class="user-info" id="perfil-btn">
          <span class="user-avatar">D</span>
          <span class="user-name">Daniela</span>
        </div>
      </nav>
    </header>

    <div class="favoritos-layout">
      <div class="favoritos-tabs-slider favoritos-tabs-top">
        <input type="radio" id="tab-publicaciones" name="favoritos-tab" checked>
        <input type="radio" id="tab-proyectos" name="favoritos-tab">
        <div class="favoritos-slider-bg"></div>
        <label for="tab-publicaciones" class="favoritos-tab-btn" onclick="mostrarTab('publicaciones')">Publicaciones</label>
        <label for="tab-proyectos" class="favoritos-tab-btn" onclick="mostrarTab('proyectos')">Proyectos</label>
      </div>
      <!-- Panel de filtros -->
      <aside class="filtros">
        <form class="filtros-form" id="filtrosForm" method="GET" action="/filtrar">
          <input type="text" id="filtro-palabra" name="palabra_clave" placeholder="Buscar por palabra clave...">
          <select id="filtro-programa" name="programa">
            <option value="">Todos los programas</option>
            <option value="desarrollo_software">Desarrollo de Software</option>
            <option value="diseno_grafico">Diseño Gráfico</option>
            <option value="administracion">Administración</option>
          </select>
          <select id="filtro-rol" name="rol">
            <option value="">Todos los roles</option>
            <option value="aprendiz">Aprendiz</option>
            <option value="egresado">Egresado</option>
            <option value="instructor">Instructor</option>
          </select>
          <input type="date" id="filtro-fecha" name="fecha" placeholder="dd/mm/aaaa">
          <!-- <button type="submit" class="btn-filtrar">Filtrar</button> -->
        </form>
        <button class="btn-limpiar" type="button" id="btnLimpiarFiltros">Limpiar Filtros</button>
      </aside>
      <!-- Contenido principal -->
      <main class="favoritos-main">
        <h2 class="favoritos-titulo">Mis Favoritos</h2>
        <div class="favoritos-lista" id="lista-publicaciones">
          <div class="proyecto-card">
            <div class="proyecto-header">
              <span class="proyecto-titulo">¿Oportunidades de prácticas en empresa de software?</span>
              <span class="proyecto-fecha">13 agosto 2025, 02:30 pm</span>
              <form method="POST" action="/favorito" style="display: inline;">
                <input type="hidden" name="publicacion_id" value="1">
                <input type="hidden" name="accion" value="toggle">
                <button class="proyecto-fav" type="submit"><i class="fa-solid fa-star"></i></button>
              </form>
            </div>
            <div class="proyecto-autor">
              Ana Gomez
              <span class="proyecto-etiqueta egresado">Egresado</span>
            </div>
            <div class="proyecto-carrera">Tecnología en Desarrollo de Software</div>
            <div class="proyecto-desc">
              La empresa TechSolutions está buscando aprendices SENA para prácticas profesionales. Requisitos: conocimientos en Java y SQL.
            </div>
            <div class="proyecto-footer" style="display: flex; align-items: center; gap: 12px;">
            <span class="proyecto-comentarios" onclick="toggleComentarios(this, 'comentariosLista1')" style="cursor:pointer; font-weight:600;">5 Respuestas</span>
            <button class="btn-abrir btn-responder" type="button" data-publicacion="1" style="margin-left:auto;">Responder</button>
          </div>
          <div class="comentarios-lista" id="comentariosLista1" style="display:none;">
          <!-- Comentarios para publicación 1 -->
            <div class="comentario-card">
              <div class="comentario-header">
                <span class="comentario-autor">Daniela Paz</span>
                <span class="comentario-etiqueta aprendiz">Aprendiz</span>
                <span class="comentario-fecha">14 agosto 2025, 01:30 pm</span>
                <button class="comentario-menu-btn" onclick="toggleMenu(this)">...</button>
                <div class="comentario-menu" style="display:none;">
                  <form method="POST" action="/reportar" style="display: inline;">
                    <input type="hidden" name="comentario_id" value="1">
                    <button type="submit">Reportar</button>
                  </form>
                  <form method="POST" action="/editar" style="display: inline;">
                    <input type="hidden" name="comentario_id" value="1">
                    <button type="submit">Editar</button>
                  </form>
                </div>
              </div>
           <div class="comentario-texto">
                Hola estoy interesada en hacer las practicas...
              </div>
            </div>
            <div class="comentario-card">
              <div class="comentario-header">
                <span class="comentario-autor">Juan Perez</span>
                <span class="comentario-etiqueta aprendiz">Aprendiz</span>
                <span class="comentario-fecha">13 agosto 2025, 11:45 am</span>
                <button class="comentario-menu-btn" onclick="toggleMenu(this)">...</button>
                <div class="comentario-menu" style="display:none;">
                  <form method="POST" action="/reportar" style="display: inline;">
                    <input type="hidden" name="comentario_id" value="2">
                    <button type="submit">Reportar</button>
                  </form>
                  <form method="POST" action="/editar" style="display: inline;">
                    <input type="hidden" name="comentario_id" value="2">
                    <button type="submit">Editar</button>
                  </form>
                </div>
              </div>
              <div class="comentario-texto">
                Me interesa Ana Gomez, mi correo es hola@mundo.com
              </div>
            </div>
            <div class="comentario-card">
              <div class="comentario-header">
                <span class="comentario-autor">Oliver Aguayo</span>
                <span class="comentario-etiqueta aprendiz">Aprendiz</span>
                <span class="comentario-fecha">13 agosto 2025, 11:30 pm</span>
                <button class="comentario-menu-btn" onclick="toggleMenu(this)">...</button>
                <div class="comentario-menu" style="display:none;">
                  <form method="POST" action="/reportar" style="display: inline;">
                    <input type="hidden" name="comentario_id" value="3">
                    <button type="submit">Reportar</button>
                  </form>
                  <form method="POST" action="/editar" style="display: inline;">
                    <input type="hidden" name="comentario_id" value="3">
                    <button type="submit">Editar</button>
                  </form>
                </div>
              </div>
              <div class="comentario-texto">
                Hola puedes por favor compartir el contacto
              </div>
            </div>
            <div class="comentario-card">
              <div class="comentario-header">
                <span class="comentario-autor">Johan Ramos</span>
                <span class="comentario-etiqueta aprendiz">Aprendiz</span>
                <span class="comentario-fecha">13 agosto 2025, 09:30 pm</span>
                <button class="comentario-menu-btn" onclick="toggleMenu(this)">...</button>
                <div class="comentario-menu" style="display:none;">
                  <form method="POST" action="/reportar" style="display: inline;">
                    <input type="hidden" name="comentario_id" value="4">
                    <button type="submit">Reportar</button>
                  </form>
                  <form method="POST" action="/editar" style="display: inline;">
                    <input type="hidden" name="comentario_id" value="4">
                    <button type="submit">Editar</button>
                  </form>
                </div>
              </div>
              <div class="comentario-texto">
                Gracias por información Ana, lo estaba necesitando
              </div>
            </div>
            <div class="comentario-card">
              <div class="comentario-header">
                <span class="comentario-autor">Cristofér Rangel</span>
                <span class="proyecto-etiqueta aprendiz">Aprendiz</span>
                <span class="comentario-fecha">14 agosto 2025, 02:30 pm</span>
                <button class="comentario-menu-btn" onclick="toggleMenu(this)">...</button>
                <div class="comentario-menu" style="display:none;">
                  <form method="POST" action="/reportar" style="display: inline;">
                    <input type="hidden" name="comentario_id" value="5">
                    <button type="submit">Reportar</button>
                  </form>
                  <form method="POST" action="/editar" style="display: inline;">
                    <input type="hidden" name="comentario_id" value="5">
                    <button type="submit">Editar</button>
                  </form>
                </div>
              </div>
              <div class="comentario-texto">
                Uyyy, que buena información, GRACIASSS...
              </div>
            </div>
          </div>
        </div>
          <!-- Repite .proyecto-card para más tarjetas -->
          <div class="proyecto-card">
            <div class="proyecto-header">
              <span class="proyecto-titulo">¿Oportunidades de prácticas en empresa de software?</span>
              <span class="proyecto-fecha">13 agosto 2025, 02:30 pm</span>
              <form method="POST" action="/favorito" style="display: inline;">
                <input type="hidden" name="publicacion_id" value="2">
                <input type="hidden" name="accion" value="toggle">
                <button class="proyecto-fav" type="submit"><i class="fa-solid fa-star"></i></button>
              </form>
            </div>
            <div class="proyecto-autor">
              Ana Gomez
              <span class="proyecto-etiqueta egresado">Egresado</span>
            </div>
            <div class="proyecto-carrera">Tecnología en Desarrollo de Software</div>
            <div class="proyecto-desc">
              La empresa TechSolutions está buscando aprendices SENA para prácticas profesionales. Requisitos: conocimientos en Java y SQL.
            </div>
            <div class="proyecto-footer" style="display: flex; align-items: center; gap: 12px;">
            <span class="proyecto-comentarios" onclick="toggleComentarios(this, 'comentariosLista2')" style="cursor:pointer; font-weight:600;">No hay comentarios</span>
            <button class="btn-abrir btn-responder" type="button" data-publicacion="2" style="margin-left:auto;">Responder</button>
          </div>
          <div class="comentarios-lista" id="comentariosLista2" style="display:none;">
            <div class="comentario-vacio">No hay comentarios.</div>
          </div>
        </div>
        </div>
        <div class="favoritos-lista" id="lista-proyectos" style="display:none;">
          <div class="proyecto-card">
            <div class="proyecto-header">
              <span class="proyecto-titulo">Menú Restaurante APP</span>
              <span class="proyecto-fecha">13 agosto 2025, 02:30 pm</span>
              <form method="POST" action="/favorito" style="display: inline;">
                <input type="hidden" name="proyecto_id" value="1">
                <input type="hidden" name="accion" value="toggle">
                <button class="proyecto-fav" type="submit"><i class="fa-solid fa-star"></i></button>
              </form>
            </div>
            <div class="proyecto-autor">
              Ana Gomez
              <span class="proyecto-etiqueta egresado">Egresado</span>
            </div>
            <div class="proyecto-carrera">Tecnología en Desarrollo de Software</div>
            <div class="proyecto-desc">
              App de menú para restaurante Amelia, va dirigido a los restaurantes que quieren tener mas visibilidad a lo que ofrecen a sus clientes
            </div>
            <div class="proyecto-footer" style="display: flex; align-items: center; gap: 12px;">
              <form method="GET" action="/proyecto/1" style="margin-left:auto;">
                <button class="btn-abrir" type="submit">Abrir</button>
              </form>
            </div>
          </div>
          <div class="proyecto-card">
            <div class="proyecto-header">
              <span class="proyecto-titulo">Menú Restaurante APP</span>
              <span class="proyecto-fecha">13 agosto 2025, 02:30 pm</span>
              <form method="POST" action="/favorito" style="display: inline;">
                <input type="hidden" name="proyecto_id" value="2">
                <input type="hidden" name="accion" value="toggle">
                <button class="proyecto-fav" type="submit"><i class="fa-solid fa-star"></i></button>
              </form>
            </div>
            <div class="proyecto-autor">
              Ana Gomez
              <span class="proyecto-etiqueta egresado">Egresado</span>
            </div>
            <div class="proyecto-carrera">Tecnología en Desarrollo de Software</div>
            <div class="proyecto-desc">
              App de menú para restaurante Amelia, va dirigido a los restaurantes que quieren tener mas visibilidad a lo que ofrecen a sus clientes
            </div>
            <div class="proyecto-footer" style="display: flex; align-items: center; gap: 12px;">
              <form method="GET" action="/proyecto/2" style="margin-left:auto;">
                <button class="btn-abrir" type="submit">Abrir</button>
              </form>
            </div>
          </div>
        </div>
<!-- Modal responder publicación -->
 
<div id="modal-responder" class="modal-responder" style="display:none;">
  <div class="modal-responder-content">
    <div class="modal-responder-title">Responder publicación</div>
    <form class="modal-responder-publicacion" action="/responder" method="POST" id="form-respuesta">
      <input type="hidden" name="publicacion_id" id="publicacion_id" value="">
      <input type="hidden" name="usuario_id" value="1">
      <textarea class="modal-responder-textarea" name="descripcion_respuesta" placeholder="Ingrese la descripción..." required></textarea>
      <div class="modal-responder-btns">
        <button type="submit" id="btn-publicar-respuesta" class="btn-publicar">Publicar</button>
        <button type="button" id="btn-cancelar-respuesta" class="btn-cancelar">Cancelar</button>
      </div>
    </form>
  </div>
</div>
     <!-- Footer -->
   </div> <!-- cierre de .main-container -->
  <footer class="footer">
    <div class="footer-content">
      <hr class="footer-line">
      <div class="footer-icons">
        <i class="fab fa-twitter"></i>
        <i class="fab fa-facebook"></i>
        <i class="fab fa-instagram"></i>
      </div>
      <hr class="footer-line">
    </div>
    <div class="footer-text">
      Copyright © 2025 SENA INTERACTIVE PORTAL
    </div>
    <div class="footer-links">
      <span>Información legal</span>
      <span>Política de privacidad</span>
    </div>
  </footer>
  </div>

    <!-- Menú Popover de Usuario -->
    <div id="popover-menu" class="popover-menu">
      <div class="popover-arrow"></div>
      <div class="popover-content">
        <ul class="popover-list">
          <li>
            <form method="GET" action="/perfil">
              <button type="submit" style="background: none; border: none; width: 100%; text-align: left; padding: 0;">
                <span class="icon">
                  <i class="fa-regular fa-user"></i>
                </span>
                <span>Perfil</span>
              </button>
            </form>
          </li>
          <li>
            <form method="GET" action="/configuracion">
              <button type="submit" style="background: none; border: none; width: 100%; text-align: left; padding: 0;">
                <span class="icon">
                  <i class="fa-solid fa-gear"></i>
                </span>
                <span>Configuración</span>
              </button>
            </form>
          </li>
          <li>
            <form method="GET" action="/favoritos">
              <button type="submit" style="background: none; border: none; width: 100%; text-align: left; padding: 0;">
                <span class="icon">
                  <i class="fa-regular fa-star"></i>
                </span>
                <span>Favoritos</span>
              </button>
            </form>
          </li>
          <li>
            <form method="GET" action="/ayuda">
              <button type="submit" style="background: none; border: none; width: 100%; text-align: left; padding: 0;">
                <span class="icon">
                  <i class="fa-regular fa-circle-question"></i>
                </span>
                <span>Ayuda</span>
              </button>
            </form>
          </li>
        </ul>
        <form method="POST" action="/logout">
          <button class="logout-btn" type="submit" id="logoutBtn">Cerrar sesión</button>
        </form>
      </div>
    </div>

    <!-- Popover de Notificaciones -->
    <div id="notificaciones-popover" class="notificaciones-popover">
      <div class="notificaciones-content">
        <div class="notificaciones-titulo">Notificaciones</div>
        <form method="POST" action="/marcar_leida">
          <input type="hidden" name="notificacion_id" value="1">
          <div class="notificacion-item" onclick="this.parentNode.submit()">
            <span class="notificacion-avatar">A</span>
            <div>
              <div class="notificacion-tipo">Respondió tu publicación</div>
              <div class="notificacion-texto">Te dare varias ideas para tu proyecto...</div>
            </div>
          </div>
        </form>
        <form method="POST" action="/marcar_leida">
          <input type="hidden" name="notificacion_id" value="2">
          <div class="notificacion-item" onclick="this.parentNode.submit()">
            <span class="notificacion-avatar">J</span>
            <div>
              <div class="notificacion-tipo">Respondió tu publicación</div>
              <div class="notificacion-texto">Te dare varias ideas para tu proyecto...</div>
            </div>
          </div>
        </form>
        <form method="POST" action="/marcar_leida">
          <input type="hidden" name="notificacion_id" value="3">
          <div class="notificacion-item" onclick="this.parentNode.submit()">
            <span class="notificacion-avatar">D</span>
            <div>
              <div class="notificacion-tipo">Comentó tu proyecto</div>
              <div class="notificacion-texto">Muchas gracias me sirvió mucho, sig...</div>
            </div>
          </div>
        </form>
      </div>
    </div>
  <script>
    // ===== MENÚ POPOVER USUARIO =====
    const perfilBtn = document.getElementById('perfil-btn');
    const popoverMenu = document.getElementById('popover-menu');

    perfilBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      if (popoverMenu.style.display === 'block') {
        popoverMenu.style.display = 'none';
      } else {
        // Calcula posición
        const rect = perfilBtn.getBoundingClientRect();
        popoverMenu.style.display = 'block';
        popoverMenu.style.position = 'absolute';
        popoverMenu.style.top = (rect.bottom + window.scrollY + 10) + 'px';
        popoverMenu.style.left = (rect.left + rect.width/2 - 160) + 'px'; // ancho aprox: 320px/2
      }
    });

    // Cerrar menú al hacer clic fuera
    document.addEventListener('click', function(e) {
      if (!popoverMenu.contains(e.target) && e.target !== perfilBtn) {
        popoverMenu.style.display = 'none';
      }
    });

    // Función para boton de publicados y proyectos
    function mostrarTab(tab) {
      document.getElementById('lista-publicaciones').style.display = (tab === 'publicaciones') ? 'flex' : 'none';
      document.getElementById('lista-proyectos').style.display = (tab === 'proyectos') ? 'flex' : 'none';
      // Mostrar/ocultar filtro de roles según el tab
      var filtroRol = document.getElementById('filtro-rol');
      if (tab === 'proyectos') {
        filtroRol.style.display = 'none';
      } else {
        filtroRol.style.display = '';
      }
    }

    // Limpiar filtros
    document.getElementById('btnLimpiarFiltros').addEventListener('click', function() {
      document.getElementById('filtro-palabra').value = '';
      document.getElementById('filtro-programa').selectedIndex = 0;
      document.getElementById('filtro-rol').selectedIndex = 0;
      document.getElementById('filtro-fecha').value = '';
    });
     // Menú de comentario
    window.toggleMenu = function(btn) {
      var menu = btn.nextElementSibling;
      menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    };
    // Mostrar/ocultar comentarios por publicación
    function toggleComentarios(btn, listaId) {
      var lista = document.getElementById(listaId);
      if (lista.style.display === 'none' || lista.style.display === '') {
        lista.style.display = 'block';
      } else {
        lista.style.display = 'none';
      }
    }
    
    // ===== POPOVER NOTIFICACIONES =====
    const notificacionesBtn = document.getElementById('notificaciones-btn');
    const notificacionesPopover = document.getElementById('notificaciones-popover');

    notificacionesBtn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      // Cierra el popover de usuario si está abierto
      popoverMenu.style.display = 'none';
      if (notificacionesPopover.style.display === 'block') {
        notificacionesPopover.style.display = 'none';
      } else {
        // Posiciona el popover debajo del botón de notificaciones
        const rect = notificacionesBtn.getBoundingClientRect();
        notificacionesPopover.style.display = 'block';
        notificacionesPopover.style.top = (rect.bottom + window.scrollY + 10) + 'px';
        notificacionesPopover.style.left = (rect.left + rect.width/2 - 170) + 'px'; // ancho aprox: 340px/2
      }
    });

    // Cierra el popover al hacer clic fuera
    document.addEventListener('click', function(e) {
      if (!notificacionesPopover.contains(e.target) && e.target !== notificacionesBtn) {
        notificacionesPopover.style.display = 'none';
      }
    });
    
    // Modal responder publicación
    const btnResponder = document.querySelectorAll('.btn-responder');
    const modalResponder = document.getElementById('modal-responder');
    const btnCancelarRespuesta = document.getElementById('btn-cancelar-respuesta');
    const formRespuesta = document.getElementById('form-respuesta');

    // Mostrar modal al hacer click en cualquier botón "Responder"
    btnResponder.forEach(btn => {
      btn.addEventListener('click', () => {
        modalResponder.style.display = 'flex';
        // Asignar el ID de la publicación al campo hidden
        const publicacionId = btn.getAttribute('data-publicacion');
        document.getElementById('publicacion_id').value = publicacionId;
      });
    });

    // Ocultar modal al hacer click en "Cancelar"
    btnCancelarRespuesta.addEventListener('click', () => {
      modalResponder.style.display = 'none';
      formRespuesta.reset();
    });

    // Ocultar modal al hacer click fuera del contenido del modal
    document.addEventListener('mousedown', function(e) {
      if (modalResponder.style.display === 'flex' && e.target === modalResponder) {
        modalResponder.style.display = 'none';
        formRespuesta.reset();
      }
    });

    // Interceptar envío del formulario para mostrar en consola
    formRespuesta.addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      console.log('Datos enviados:', Object.fromEntries(formData));
      alert('Respuesta enviada! Ver datos en el inspector (consola)');
      modalResponder.style.display = 'none';
      this.reset();
    });

    // Interceptar envío de filtros
    document.getElementById('filtrosForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      console.log('Filtros aplicados:', Object.fromEntries(formData));
      alert('Filtros aplicados! Ver datos en el inspector (consola)');
    });

    // Interceptar todos los formularios para mostrar datos en consola
    document.querySelectorAll('form').forEach(form => {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const action = this.getAttribute('action');
        const method = this.getAttribute('method');
        console.log(`Formulario enviado - Action: ${action}, Method: ${method}`, Object.fromEntries(formData));
        
        if (action === '/logout') {
          alert('Sesión cerrada! Ver datos en el inspector (consola)');
        } else if (!action.includes('/responder') && !action.includes('/filtrar')) {
          alert(`Acción: ${action} - Ver datos en el inspector (consola)`);
        }
      });
    });
  </script>
</body>
</html>